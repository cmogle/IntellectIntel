<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intellect Intelligence â€” Share Prices</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { background: #fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; padding: 16px; }
  h1 { font-size: 18px; color: #1a1a2e; margin-bottom: 4px; }
  .subtitle { font-size: 12px; color: #888; margin-bottom: 16px; }
  .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
  .card { border: 1px solid #e8e8e8; border-radius: 12px; padding: 16px; background: #fafafa; }
  .card-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 8px; }
  .ticker-name { font-size: 14px; font-weight: 600; color: #1a1a2e; }
  .ticker-exchange { font-size: 11px; color: #999; }
  .price { font-size: 22px; font-weight: 700; color: #1a1a2e; }
  .change { font-size: 13px; font-weight: 500; margin-left: 8px; }
  .change.up { color: #00c853; }
  .change.down { color: #ff1744; }
  .price-row { display: flex; align-items: baseline; margin-bottom: 8px; }
  .chart-container { height: 120px; }
  .year-change { font-size: 11px; margin-bottom: 8px; }
  .updated-note { font-size: 11px; color: #bbb; margin-top: 16px; text-align: right; }
  @media (max-width: 900px) { .grid { grid-template-columns: repeat(2, 1fr); } }
  @media (max-width: 500px) { .grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>
<h1>ðŸ“ˆ Intellect Intelligence â€” Share Prices</h1>
<p class="subtitle">12-month view â€¢ Updated daily</p>
<div class="grid" id="grid"></div>
<p class="updated-note" id="updated"></p>
<script>
const currencySymbols = { INR: "â‚¹", USD: "$", CHF: "CHF ", EUR: "â‚¬", GBP: "Â£" };

function formatPrice(price, currency) {
  const prefix = currencySymbols[currency] || currency + " ";
  return prefix + price.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
}

function renderStock(stock) {
  const grid = document.getElementById("grid");
  const card = document.createElement("div");
  card.className = "card";

  if (stock.error) {
    card.innerHTML = `<div class="card-header"><span class="ticker-name">${stock.name}</span><span class="ticker-exchange">${stock.exchange}</span></div><div style="color:#ff1744;font-size:12px;padding:20px 0">Data unavailable</div>`;
    grid.appendChild(card);
    return;
  }

  const isUp = stock.changePct >= 0;
  const yearUp = stock.yearChange >= 0;
  const id = stock.symbol.replace(/[^a-zA-Z]/g, "");

  card.innerHTML = `
    <div class="card-header">
      <span class="ticker-name">${stock.name}</span>
      <span class="ticker-exchange">${stock.exchange}</span>
    </div>
    <div class="price-row">
      <span class="price">${formatPrice(stock.price, stock.currency)}</span>
      <span class="change ${isUp ? 'up' : 'down'}">${isUp ? 'â–²' : 'â–¼'} ${Math.abs(stock.changePct).toFixed(2)}%</span>
    </div>
    <div class="year-change" style="color:${yearUp ? '#00c853' : '#ff1744'}">
      ${yearUp ? 'â†‘' : 'â†“'} ${Math.abs(stock.yearChange).toFixed(1)}% over 12 months
    </div>
    <div class="chart-container"><canvas id="chart-${id}"></canvas></div>
  `;
  grid.appendChild(card);

  const ctx = document.getElementById(`chart-${id}`).getContext("2d");
  const gradient = ctx.createLinearGradient(0, 0, 0, 120);
  const color = yearUp ? "41, 98, 255" : "255, 23, 68";
  gradient.addColorStop(0, `rgba(${color}, 0.15)`);
  gradient.addColorStop(1, `rgba(${color}, 0)`);

  new Chart(ctx, {
    type: "line",
    data: {
      datasets: [{
        data: stock.points.map(p => ({ x: new Date(p[0]), y: p[1] })),
        borderColor: `rgba(${color}, 1)`,
        backgroundColor: gradient,
        borderWidth: 1.5,
        fill: true,
        pointRadius: 0,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: false }, tooltip: { enabled: false } },
      scales: {
        x: { type: "time", display: false },
        y: { display: false }
      },
      animation: false
    }
  });
}

async function init() {
  try {
    const resp = await fetch("data.json?" + Date.now());
    const data = await resp.json();
    data.stocks.forEach(renderStock);
    const d = new Date(data.updated);
    document.getElementById("updated").textContent = `Last updated: ${d.toLocaleDateString("en-GB", { weekday: "short", day: "numeric", month: "short", year: "numeric", hour: "2-digit", minute: "2-digit" })}`;
  } catch (e) {
    document.getElementById("grid").innerHTML = '<div style="color:#ff1744;padding:40px">Unable to load data. Please try again later.</div>';
  }
}

init();
</script>
</body>
</html>
